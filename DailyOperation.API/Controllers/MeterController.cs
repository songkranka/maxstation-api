using AutoMapper;
using DailyOperation.API.Domain.Models;
using DailyOperation.API.Domain.Models.Meter;
using DailyOperation.API.Domain.Models.Queries;
using DailyOperation.API.Domain.Services;
using DailyOperation.API.Resources;
using DailyOperation.API.Services;
using log4net;
using MaxStation.Entities.Models;
using MaxStation.Utility.Caches;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace DailyOperation.API.Controllers
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class MeterController : BaseController
    {
        private static readonly ILog log = LogManager.GetLogger(typeof(DemoController));
        private readonly IMeterService _meterService;
        private readonly IMapper _mapper;
        private readonly ICommonCacheHelper _cacheHelper;
        //private static readonly ILog log = LogManager.GetLogger(typeof(MeterController));

        public MeterController(
            IMeterService meterService,
            IMapper mapper,
            ICommonCacheHelper cacheHelper,
            PTMaxstationContext context) : base(context)
        {
            _meterService = meterService;
            _mapper = mapper;
            _cacheHelper = cacheHelper;
        }



        [HttpPost("TestLog")]
        public IActionResult TestLog()
        {
            try
            {
                throw new Exception($"TestLog: {DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")}");
                //return Ok("hello");
            }
            catch (Exception ex)
            {
                //log.Error("Error", ex);
                return BadRequest(ex.Message);
            }
        }


        [HttpPost("SaveDocument")]
        [ProducesResponseType(typeof(MeterResponse), 200)]
        [ProducesResponseType(typeof(ErrorResource), 400)]
        public async Task<IActionResult> SaveDocument([FromBody] SaveDocumentRequest req)
        {
            MeterResponse response = new MeterResponse();
            if(req.Meter.Employee.Count == 0)
            {
                //กรุณาเลือกผู้รับผิดชอบการขายก่อนบันทึกข้อมูล
                response.StatusCode = StatusCodes.Status400BadRequest;
                response.Status = "Fail";
                response.Message = "กรุณาเลือกผู้รับผิดชอบการขายก่อนบันทึกข้อมูล";
                return BadRequest(response);
            }
            try
            {
                response = await _meterService.SaveDocument(req);                
                return Ok(JsonConvert.SerializeObject(response));
            }
            catch (Exception ex)
            {
                //log.Error("SaveDocument", ex);
                response.StatusCode = StatusCodes.Status400BadRequest;
                response.Status = "Fail";
                response.Message = ex.Message;
                return BadRequest(response);
            }
        }

        [HttpPost("SubmitDocument")]
        [ProducesResponseType(typeof(MeterResponse), 200)]
        [ProducesResponseType(typeof(ErrorResource), 400)]
        public async Task<IActionResult> SubmitDocument([FromBody] SaveDocumentRequest req)
        {
            MeterResponse response = new MeterResponse();
            try
            {   
                response = await _meterService.SubmitDocument(req);                
                return Ok(JsonConvert.SerializeObject(response));
            }
            catch (Exception ex)
            {
                if (await LogErrorService.ConnectServer())
                {
                    await LogErrorService.WriteErrorLog(ex);
                    await LogErrorService.DisConnectServer();
                }
                //log.Error("SaveDocument", ex);
                response.StatusCode = StatusCodes.Status400BadRequest;
                response.Status = "Fail";
                response.Message = ex.Message;
                return BadRequest(response);
            }
        }

        [HttpPost("DeleteDocument")]
        [ProducesResponseType(typeof(MeterResponse), 200)]
        [ProducesResponseType(typeof(ErrorResource), 400)]
        public async Task<IActionResult> DeleteDocument([FromBody] DeleteDocumentRequest req)
        {
            MeterResponse response = new MeterResponse();
            try
            {
                var result = await _meterService.DeleteDocument(req);                
                return Ok(JsonConvert.SerializeObject(response));
            }
            catch (Exception ex)
            {

               //log.Error("DeleteDocument", ex);
                response.StatusCode = StatusCodes.Status400BadRequest;
                response.Status = "Fail";
                response.Message = ex.Message;
                return BadRequest(response);
            }
        }

        [HttpPost("GetDocument")]
        [ProducesResponseType(typeof(DopPeriodMeter), 200)]
        [ProducesResponseType(typeof(ErrorResource), 400)]
        public async Task<IActionResult> GetDocument([FromBody] GetDocumentRequest req)
        {
            ResponseData<List<GetDocumentResponse>> response = new ResponseData<List<GetDocumentResponse>>();
            try
            {
                
                var result = await _meterService.GetDocument(req);

                if (!result.Success)
                {
                    //log.Error("GetDocument : " + result.Message);
                    return BadRequest(new ErrorResource(result.Message));
                }

                response.Data = result.Resource;
                response.TotalItems = result.TotalItems;
                response.StatusCode = StatusCodes.Status200OK;
                response.Message = "Success";                
                return Ok(JsonConvert.SerializeObject(response));
            }
            catch (Exception ex)
            {
                if (await LogErrorService.ConnectServer())
                {
                    await LogErrorService.WriteErrorLog(ex);
                    await LogErrorService.DisConnectServer();
                }
                //log.Error("GetDocument", ex);
                Console.WriteLine($"[{HttpContext.Request.Path.Value}] [{req.BrnCode}] : {ex.Message}");
                response.StatusCode = StatusCodes.Status400BadRequest;
                response.Message = ex.Message;
                return BadRequest(response);
            }
        }

        [HttpPost("GetPosMeter2")]
        [ProducesResponseType(typeof(QueryResultResource<MasBranchMeterResponse>), 200)]
        public ContentResult GetPosMeter2([FromBody] BranchMeterRequest req)
        {
            string strJson = "{\r\n    \"totalItems\": 0,\r\n    \"items\": [\r\n        {\r\n            \"periodStart\": null,\r\n            \"periodFinish\": null,\r\n            \"masBranchDispItems\": [\r\n                {\r\n                    \"meterStart\": 120778.49,\r\n                    \"meterFinish\": 120836.84,\r\n                    \"saleQty\": 58.35,\r\n                    \"saleAmt\": 2235.1,\r\n                    \"cashAmt\": 2235.1,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 58.35,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0101\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 1,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 77293.45,\r\n                    \"meterFinish\": 77355.83,\r\n                    \"saleQty\": 62.38,\r\n                    \"saleAmt\": 2320,\r\n                    \"cashAmt\": 2320,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 62.38,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0102\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 2,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 75787.19,\r\n                    \"meterFinish\": 75825.85,\r\n                    \"saleQty\": 38.66,\r\n                    \"saleAmt\": 1470.2,\r\n                    \"cashAmt\": 1470.2,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.03,\r\n                    \"totalQty\": 38.66,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0103\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"02\",\r\n                    \"pdId\": \"000006\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 91\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 3,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 77916.84,\r\n                    \"meterFinish\": 78002.24,\r\n                    \"saleQty\": 85.4,\r\n                    \"saleAmt\": 3270,\r\n                    \"cashAmt\": 3270,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 85.4,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0104\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 4,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 16039.36,\r\n                    \"meterFinish\": 16045.55,\r\n                    \"saleQty\": 6.19,\r\n                    \"saleAmt\": 230,\r\n                    \"cashAmt\": 230,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 6.19,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0105\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 5,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 32418.7,\r\n                    \"meterFinish\": 32443.98,\r\n                    \"saleQty\": 25.28,\r\n                    \"saleAmt\": 962.3,\r\n                    \"cashAmt\": 962.3,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.03,\r\n                    \"totalQty\": 25.28,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0106\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"02\",\r\n                    \"pdId\": \"000006\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 91\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 6,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 452323.86,\r\n                    \"meterFinish\": 452653.94,\r\n                    \"saleQty\": 330.08,\r\n                    \"saleAmt\": 9900,\r\n                    \"cashAmt\": 9900,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 330.08,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0201\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 7,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 260712.57,\r\n                    \"meterFinish\": 261139.35,\r\n                    \"saleQty\": 426.78,\r\n                    \"saleAmt\": 12800,\r\n                    \"cashAmt\": 12800,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 426.78,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0202\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"05\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 8,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 107317.27,\r\n                    \"meterFinish\": 107474.32,\r\n                    \"saleQty\": 157.05,\r\n                    \"saleAmt\": 4710,\r\n                    \"cashAmt\": 4710,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 100,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 157.05,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0203\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 9,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 47150.78,\r\n                    \"meterFinish\": 47214.13,\r\n                    \"saleQty\": 63.35,\r\n                    \"saleAmt\": 1900,\r\n                    \"cashAmt\": 1900,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 63.35,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0204\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"05\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 10,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 195623.13,\r\n                    \"meterFinish\": 195706.47,\r\n                    \"saleQty\": 83.34,\r\n                    \"saleAmt\": 3191.7,\r\n                    \"cashAmt\": 3191.7,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 83.34,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0301\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 11,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 119439.83,\r\n                    \"meterFinish\": 119511.12,\r\n                    \"saleQty\": 71.29,\r\n                    \"saleAmt\": 2650.7,\r\n                    \"cashAmt\": 2650.7,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 71.29,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0302\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 12,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 102372.65,\r\n                    \"meterFinish\": 102479.81,\r\n                    \"saleQty\": 107.16,\r\n                    \"saleAmt\": 4074.8,\r\n                    \"cashAmt\": 4074.8,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.03,\r\n                    \"totalQty\": 107.16,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0303\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"02\",\r\n                    \"pdId\": \"000006\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 91\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 13,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 37201.13,\r\n                    \"meterFinish\": 37220.98,\r\n                    \"saleQty\": 19.85,\r\n                    \"saleAmt\": 760,\r\n                    \"cashAmt\": 610,\r\n                    \"creditAmt\": 150,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 19.85,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0304\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 14,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 10912.18,\r\n                    \"meterFinish\": 10921.86,\r\n                    \"saleQty\": 9.68,\r\n                    \"saleAmt\": 360,\r\n                    \"cashAmt\": 360,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 9.68,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0305\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 15,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 15694.17,\r\n                    \"meterFinish\": 15698.11,\r\n                    \"saleQty\": 3.94,\r\n                    \"saleAmt\": 150,\r\n                    \"cashAmt\": 150,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.03,\r\n                    \"totalQty\": 3.94,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0306\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"02\",\r\n                    \"pdId\": \"000006\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 91\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 16,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 503256.29,\r\n                    \"meterFinish\": 503687.73,\r\n                    \"saleQty\": 431.44,\r\n                    \"saleAmt\": 12940,\r\n                    \"cashAmt\": 12940,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 17,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 431.44,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0401\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 17,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 291928.58,\r\n                    \"meterFinish\": 292519.42,\r\n                    \"saleQty\": 590.84,\r\n                    \"saleAmt\": 17720,\r\n                    \"cashAmt\": 17720,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 590.84,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0402\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"05\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 18,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 111243.34,\r\n                    \"meterFinish\": 111376.71,\r\n                    \"saleQty\": 133.37,\r\n                    \"saleAmt\": 4000,\r\n                    \"cashAmt\": 4000,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 133.37,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0403\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 19,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 54232,\r\n                    \"meterFinish\": 54258.68,\r\n                    \"saleQty\": 26.68,\r\n                    \"saleAmt\": 800,\r\n                    \"cashAmt\": 800,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 26.68,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0404\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"05\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 20,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 47061.33,\r\n                    \"meterFinish\": 47082.21,\r\n                    \"saleQty\": 20.88,\r\n                    \"saleAmt\": 800,\r\n                    \"cashAmt\": 800,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 20.88,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0501\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 21,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 33559.96,\r\n                    \"meterFinish\": 33559.96,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0502\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 22,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 2815.93,\r\n                    \"meterFinish\": 2823.76,\r\n                    \"saleQty\": 7.83,\r\n                    \"saleAmt\": 300,\r\n                    \"cashAmt\": 300,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 7.83,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0503\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 23,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 2033.31,\r\n                    \"meterFinish\": 2033.31,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 37.19,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0504\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"01\",\r\n                    \"pdId\": \"000010\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ E20\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 24,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 258285.3,\r\n                    \"meterFinish\": 258464.02,\r\n                    \"saleQty\": 178.72,\r\n                    \"saleAmt\": 5360,\r\n                    \"cashAmt\": 5360,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 178.72,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0601\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 25,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 151810.82,\r\n                    \"meterFinish\": 151944.19,\r\n                    \"saleQty\": 133.37,\r\n                    \"saleAmt\": 4000,\r\n                    \"cashAmt\": 4000,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 133.37,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0602\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"06\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 26,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 48400.61,\r\n                    \"meterFinish\": 48400.61,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0603\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"04\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 27,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 34541.82,\r\n                    \"meterFinish\": 34541.82,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0604\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"06\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 28,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 5581.96,\r\n                    \"meterFinish\": 5581.96,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0701\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 29,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 394.86,\r\n                    \"meterFinish\": 394.86,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 38.3,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0702\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"03\",\r\n                    \"pdId\": \"000005\",\r\n                    \"pdName\": \"แก๊สโซฮอล์ 95\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 30,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 94719.34,\r\n                    \"meterFinish\": 94719.34,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0801\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"06\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 31,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                },\r\n                {\r\n                    \"meterStart\": 27001.36,\r\n                    \"meterFinish\": 27001.36,\r\n                    \"saleQty\": 0,\r\n                    \"saleAmt\": 0,\r\n                    \"cashAmt\": 0,\r\n                    \"creditAmt\": 0,\r\n                    \"discAmt\": 0,\r\n                    \"couponAmt\": 0,\r\n                    \"repairStart\": 0,\r\n                    \"repairFinish\": null,\r\n                    \"repairQty\": 0,\r\n                    \"testStart\": 0,\r\n                    \"testQty\": 0,\r\n                    \"cardAmt\": 0,\r\n                    \"remark\": null,\r\n                    \"periodStatus\": \"Active\",\r\n                    \"post\": null,\r\n                    \"unitPrice\": 29.99,\r\n                    \"totalQty\": 0,\r\n                    \"compCode\": \"B\",\r\n                    \"brnCode\": \"28S\",\r\n                    \"dispId\": \"0802\",\r\n                    \"dispStatus\": \"Active\",\r\n                    \"meterMax\": 0,\r\n                    \"serialNo\": null,\r\n                    \"tankId\": \"06\",\r\n                    \"pdId\": \"000001\",\r\n                    \"pdName\": \"ดีเซล B7\",\r\n                    \"unitId\": null,\r\n                    \"unitBarcode\": null,\r\n                    \"hoseId\": 32,\r\n                    \"createdDate\": \"2022-04-18T09:35:08.527\",\r\n                    \"createdBy\": \"532092\",\r\n                    \"updatedDate\": null,\r\n                    \"updatedBy\": null\r\n                }\r\n            ],\r\n            \"masBranchTankItems\": null,\r\n            \"masBranchCashDrItems\": [],\r\n            \"masBranchCashCrItems\": null\r\n        }\r\n    ],\r\n    \"itemsPerPage\": 0,\r\n    \"isSuccess\": true,\r\n    \"message\": \"\"\r\n}";
            return Content(strJson, "application/JSON");
        }


        [HttpPost("GetPosMeter")]
        [ProducesResponseType(typeof(QueryResultResource<MasBranchMeterResponse>), 200)]
        //public async Task<QueryResultResource<MasBranchMeterResponse>> GetPosMeter([FromBody] BranchMeterRequest req)
        public async Task< IActionResult> GetPosMeter([FromBody] BranchMeterRequest req)
        {
            QueryResultResource<MasBranchMeterResponse> response = new QueryResultResource<MasBranchMeterResponse>();
            try
            {
                var cacheKey = _cacheHelper.GetRequestName($"GetPosMeter_{req.CompCode}_{req.BrnCode}_{req.DocDate:ddMMyyyy}_{req.PeriodNo}");
                response = _cacheHelper.GetAsync<QueryResultResource<MasBranchMeterResponse>>(cacheKey).Result;

                if (response == null)
                {
                    var queryResult = _meterService.GetPosMeter(req).Result;
                    var result = _mapper.Map<QueryResult<MasBranchMeterResponse>, QueryResultResource<MasBranchMeterResponse>>(queryResult);
                    await _cacheHelper.CreateAsync(cacheKey, result);
                    response = result;
                }

                //var queryResult = _meterService.GetPosMeter(req).Result;
                //response = _mapper.Map<QueryResult<MasBranchMeterResponse>, QueryResultResource<MasBranchMeterResponse>>(queryResult);
                response.IsSuccess = true;
                response.Message = "";
                //log.Info(req);
                return Ok(response);
                //return response;
            }
            catch (Exception ex)
            {
                if (await LogErrorService.ConnectServer())
                {
                    await LogErrorService.WriteErrorLog(ex);
                    await LogErrorService.DisConnectServer();
                }
                //log.Error("GetPosMeter : " + ex.Message);
                Console.WriteLine($"[{HttpContext.Request.Path.Value}] [{req.BrnCode}] : {ex.Message}");
                response.IsSuccess = false;
                response.Message = ex.Message;
                return BadRequest (response);
            }
        }

        [HttpPost("GetMasBranchCalibrate")]
        [ProducesResponseType(typeof(QueryResultResource<MasBranchCalibrate>), 200)]
        public QueryResultResource<MasBranchCalibrate> GetMasBranchCalibrate([FromBody] MasBranchCalibrateRequest req)
        {
            QueryResultResource<MasBranchCalibrate> response = new QueryResultResource<MasBranchCalibrate>();
            try
            {
                var queryResult = _meterService.GetMasBranchCalibrate(req);

                response = _mapper.Map<QueryResult<MasBranchCalibrate>, QueryResultResource<MasBranchCalibrate>>(queryResult);
                response.IsSuccess = true;
                response.Message = "";
                return response;
            }
            catch (Exception ex)
            {
                //log.Error("GetMasBranchCalibrate : " + ex.Message);
                response.IsSuccess = false;
                response.Message = ex.Message;
                return response;
            }
        }
        //public async Task<MasReason[]> GetHoldReason()
        [HttpGet("GetHoldReason")]
        public async Task<IActionResult> GetHoldReason()
        {
            return await DefaultService.DoActionAsync("GetHoldReason", async () => await _meterService.GetHoldReason(), log);
        }

        [HttpGet("ValidatePOS/{pStrBrnCode}/{pIntPeriodNo}/{pDatDocDate}")]
        public async Task<IActionResult> ValidatePOS(string pStrBrnCode, int pIntPeriodNo, DateTime pDatDocDate)
        {
            return await DefaultService.DoActionAsync("ValidatePOS", async () => await _meterService.ValidatePOS(pStrBrnCode , pIntPeriodNo , pDatDocDate),log);
        }
    }
}
